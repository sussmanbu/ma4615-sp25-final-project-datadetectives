---
title: Analysis
description: Here we provide a detailed analysis using more sophisticated statistics techniques.
toc: true
draft: false
---


![](images/anlysisCover.png)

## Introduction

### Objective and Research Questions

The goal of our analysis is to examine how macroeconomic trends in the aftermath of the 2008 recession, such as shifting interest rates, affected different racial and socioeconomic groups in the United States. We aim to answer some of the following general research questions:

- How do income and employment differ across gender, race, and education levels during periods of economic downturn?
- What factors contribute to upward economic mobility?
- Are there persistent racial disparities in long-term wealth accumulation?

To limit the scope of the project, we decided to look at the age cohort of people born between 1957 and 1964, represented by the Bureau of Labor Statisticsâ€™ NLS 79 survey, who were working adults at the time of the recession. Looking at this population, some of the following questions for analysis arise: 

- What effect did falling interest rates during the recession have on income? Can this relationship be modeled 
- Did the recession exacerbate income inequality differently along racial, socioeconomic, regional, or other lines? 

### Motivating Figures and Tables: Demographic Factors

The following graphs explore some of the relationships between variables in our data to motivate this goal.
```{r setup, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(scales)
library(purrr)
library(readr)
library(here)
```

```{r aretha graphs, echo= FALSE, warning=FALSE}
library(scales)
nls_data_clean <- read_rds("dataset/nls_clean.rds")

nls_data_clean <- nls_data_clean %>%
  filter(!is.na(Region))

# Regional Variation in Gender Income Gap
ggplot(nls_data_clean, aes(x = Region, y = Income_2010, fill = Sex)) +
  geom_boxplot(outlier.alpha = 0.5, outlier.size = 1) +
  labs(title = "Income Distribution by Region and Gender",
       x = "Region", 
       y = "Total Income (Previous Year)", 
       fill = "Gender") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_y_continuous(labels = scales::comma)
```

This box plot explores the difference in income along gender and racial lines. Across all regions, men appear to make more money than women. However, this effect is particularly pronounced in the South and West regions, where the box plot indicates that a higher proportion of women do not make any income. This higher number of zero-income observations causes some issues for analysis to be accounted for during outlier removal. The graph also highlights the potential difference in effect of income declines across groups. 

```{r ran graphs, echo= FALSE}
library(scales)
nls_data_clean <- read_rds("dataset/nls_clean.rds")

nls_data_clean_filtered <- nls_data_clean %>%
  filter(!is.na(Income_2010), is.finite(Income_2010))

ggplot(nls_data_clean_filtered, aes(x = factor(Age_2010), y = Income_2010)) + geom_boxplot() + facet_wrap(~ Sex + Race) + scale_y_continuous(labels = dollar_format(prefix = "$", suffix = "K", scale = 1/1000)) + labs(x = "Age in 2010", y = "Total Income for Year", title = "Total Income For Year 2010 Filtered by Age, Race, and Sex") + theme_minimal()

```

### Motivating Figures and Tables: Interest Rates

```{r datacombination, echo= FALSE, warning=FALSE, message=FALSE}

nls_with_rates_full<-read_csv("./dataset/nls_with_rates_full.csv")

income_by_race <- nls_with_rates_full %>%
  group_by(Income_Year, Race) %>%
  summarise(
    avg_income = mean(Income, na.rm = TRUE),
    avg_interest = mean(avg_LT_rate, na.rm = TRUE)
  ) %>%
  ungroup()
library(ggplot2)

ggplot(income_by_race, aes(x = Income_Year, y = avg_income, color = avg_interest)) +
  geom_line(aes(group = Race), size = 1.2) +
  geom_point(aes(shape = Race), size = 2) +
  facet_wrap(~ Race) +
  scale_color_viridis_c(option = "magma") +
  labs(
    title = "Average Income Over Time by Race (Colored by Interest Rate)",
    x = "Year",
    y = "Average Income",
    color = "Interest Rate",
    shape = "Race"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")

```

## Modeling and Inference

First tried with outliers and had bad figures, and we determined there were severe outliers impacting our model. 

```{r outliers, echo= FALSE, message=FALSE}
library(tidyverse)

# Load the data
nls_with_rates <- read_csv("dataset/nls_with_rates_full.csv")


# Calculate IQR and bounds
Q1 <- quantile(nls_with_rates$Income, 0.25, na.rm = TRUE)
Q3 <- quantile(nls_with_rates$Income, 0.75, na.rm = TRUE)
IQR_value <- Q3 - Q1

lower_bound <- Q1 - .20 * IQR_value
upper_bound <- Q3 + 1.75 * IQR_value

# Plot histogram with cutoff lines
ggplot(nls_with_rates, aes(x = Income)) +
  geom_histogram(binwidth = 5000, color = "black", fill = "lightblue") +
  geom_vline(xintercept = lower_bound, color = "red", linetype = "dashed", size = 1) +
  geom_vline(xintercept = upper_bound, color = "red", linetype = "dashed", size = 1) +
  annotate("text", x = lower_bound, y = 3000, label = "Lower Bound", angle = 90, vjust = -0.5, color = "red") +
  annotate("text", x = upper_bound, y = 3000, label = "Upper Bound", angle = 90, vjust = -0.5, color = "red") +
  labs(title = "Histogram of Income with Outlier Cutoff Lines",
       subtitle = "Red dashed lines indicate outlier thresholds",
       x = "Income",
       y = "Count") +
  theme_minimal()

```
We therefore used R script like below to remove these and create a new dataset specifically for modeling. 

```r
library(tidyverse)

# Load  merged dataset
nls_with_rates <- read_csv("dataset/nls_with_rates_full.csv")

# Step 1: Calculate IQR boundaries
Q1 <- quantile(nls_with_rates$Income, 0.25, na.rm = TRUE)
Q3 <- quantile(nls_with_rates$Income, 0.75, na.rm = TRUE)
IQR_value <- Q3 - Q1

lower_bound <- Q1 - 0.24 * IQR_value #lots of 0 (n/a) data
upper_bound <- Q3 + 1.5 * IQR_value

# Step 2: Filter out the outliers
nls_no_outliers <- nls_with_rates %>%
  filter(Income >= lower_bound & Income <= upper_bound)

# Step 3: Save it
write_csv(nls_no_outliers, "dataset/nls_no_outliers.csv")
```

```{r statisticsmod, echo=FALSE, message=FALSE,warning=FALSE}
library(car)
library(sandwich)
library(lmtest)

nls_data_tbu <- read_csv("dataset/nls_no_outliers.csv")
nls_data_modeling <- nls_data_tbu %>%
   filter(Income_Year %in% c(2006, 2008, 2010)) %>%
   mutate(edu_bin = case_when(
     Highest_Grade_Completed %in% c(
       "UNGRADED", "1ST GRADE",  "2ND GRADE",  "3RD GRADE", "4TH GRADE",  
        "5TH GRADE",  "6TH GRADE", "7TH GRADE",  "8TH GRADE") ~ "Less than HS",
      Highest_Grade_Completed %in% c("9TH GRADE", "10TH GRADE",
                                     "11TH GRADE", "12TH GRADE") ~ "High School",
      Highest_Grade_Completed %in% c("1ST YEAR COLLEGE", "2ND YEAR COLLEGE", "3RD YEAR COLLEGE"
      ) ~ "Some College",
      Highest_Grade_Completed %in% c("4TH YEAR COLLEGE", "5TH YEAR COLLEGE", "6TH YEAR COLLEGE",
        "7TH YEAR COLLEGE", "8TH YEAR COLLEGE OR MORE") ~ "College+",
      TRUE ~ NA_character_)) %>%
  filter(!is.na(edu_bin)) %>%
  mutate(edu_bin = factor(edu_bin, levels = c("Less than HS", "High School", "Some College", "College+"))) %>% na.omit()
 
model = lm(Income ~ Race + Sex + Marital_Status + Age_2010 + Region + edu_bin + avg_LT_rate, data = filter(nls_data_modeling))
plot(model, which=c(1))
plot(model, which=c(2))
 
model_data = model.frame(model)
model_data$Predicted = predict(model)
summary(model)
vif(model, type = "predictor")
coeftest(model, vcov = vcovHC(model, type = "HC1"))

```

## Results, Limitations, and Conclusion
